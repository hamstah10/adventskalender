<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers" data-namespace-typo3-fluid="true">

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<f:if condition="{voucher} && !{voucher.deleted}">
    <div class="voucher-container">
        <f:if condition="{voucher.design} == 'santa'">
            <f:then>
                <div class="voucher voucher-santa" id="voucherElement">
                    <div class="voucher-santa-header">
                        <div class="voucher-santa-icon">üéÖ</div>
                        <h3 class="voucher-title">{voucher.headline}</h3>
                    </div>
                    <div class="voucher-santa-body">
                        <div class="voucher-santa-snow">‚ùÑÔ∏è ‚ùÑÔ∏è ‚ùÑÔ∏è</div>
                        <div class="voucher-for">
                            <span class="voucher-label">F√ºr:</span>
                            <span class="voucher-name">{voucher.forName}</span>
                        </div>
                        <div class="voucher-description">
                            {voucher.description}
                        </div>
                        <div class="voucher-from">
                            <span class="voucher-label">Von:</span>
                            <span class="voucher-name">{voucher.fromName}</span>
                        </div>
                        <div class="voucher-code-section">
                            <div class="voucher-qrcode" id="qrcode-santa-{voucher.uid}"></div>
                            <div class="voucher-code-text">
                                <span class="voucher-code-label">Code:</span>
                                <span class="voucher-code">{voucher.voucherCode}</span>
                            </div>
                        </div>
                        <div class="voucher-santa-footer">
                            üéÑ Ho Ho Ho! üéÑ
                        </div>
                        <div class="voucher-date">0{day}.12.2025</div>
                    </div>
                </div>
            </f:then>
            <f:else>
                <div class="voucher voucher-classic" id="voucherElement">
                    <div class="voucher-border">
                        <div class="voucher-snowflakes">‚ùÑÔ∏è ‚ùÑÔ∏è ‚ùÑÔ∏è ‚ùÑÔ∏è ‚ùÑÔ∏è</div>
                        <div class="voucher-header">
                            <div class="voucher-icon">üéÅ</div>
                            <h3 class="voucher-title">{voucher.headline}</h3>
                        </div>
                        <div class="voucher-body">
                            <div class="voucher-for">
                                <span class="voucher-label">F√ºr:</span>
                                <span class="voucher-name">{voucher.forName}</span>
                            </div>
                            <div class="voucher-description">
                                {voucher.description}
                            </div>
                            <div class="voucher-from">
                                <span class="voucher-label">Von:</span>
                                <span class="voucher-name">{voucher.fromName}</span>
                            </div>
                            <div class="voucher-code-section">
                                <div class="voucher-qrcode" id="qrcode-classic-{voucher.uid}"></div>
                                <div class="voucher-code-text">
                                    <span class="voucher-code-label">Code:</span>
                                    <span class="voucher-code">{voucher.voucherCode}</span>
                                </div>
                            </div>
                        </div>
                        <div class="voucher-footer">
                            <div class="voucher-snowflakes">üéÑ ‚≠ê üéÑ ‚≠ê üéÑ</div>
                        </div>
                        <div class="voucher-date">0{day}.12.2025</div>
                    </div>
                </div>
            </f:else>
        </f:if>
        <div class="voucher-download-container">
            <button class="voucher-download-btn" onclick="downloadVoucher()">
                <i class="bi bi-download"></i> <f:translate key="LLL:EXT:adventskalender/Resources/Private/Language/locallang.xlf:voucher.download" />
            </button>
        </div>
    </div>
</f:if>

<script>
    // Generate QR codes for vouchers
    document.addEventListener('DOMContentLoaded', function() {
        const voucherElements = document.querySelectorAll('[id^="qrcode-"]');
        voucherElements.forEach(function(element) {
            // Extract the voucher code from the nearby code span
            const voucherSection = element.closest('.voucher-code-section');
            if (voucherSection) {
                const codeSpan = voucherSection.querySelector('.voucher-code');
                if (codeSpan && codeSpan.textContent.trim()) {
                    new QRCode(element, {
                        text: codeSpan.textContent.trim(),
                        width: 120,
                        height: 120,
                        colorDark: '#000000',
                        colorLight: '#ffffff',
                        correctLevel: QRCode.CorrectLevel.H
                    });
                }
            }
        });
    });
</script>

</html>
